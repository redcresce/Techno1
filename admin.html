<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin - تكنو تل</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>body{font-family:'Cairo',sans-serif;background:#f7f9fc;padding:20px} .card{border-radius:12px}</style>
</head>
<body>
<div class="container">
  <div class="card p-4">
    <h3>لوحة إدارة منتجات — تكنو تل</h3>
    <p class="text-muted">أمان: أدخل كلمة المرور للمتابعة. (غيّرها في الكود بعد النشر)</p>

    <div id="loginBox">
      <div class="mb-3">
        <input id="pwd" type="password" class="form-control" placeholder="كلمة المرور">
      </div>
      <button class="btn btn-primary" onclick="login()">دخول</button>
    </div>

    <div id="adminUI" style="display:none;margin-top:20px">
      <div class="mb-3 row">
        <div class="col-md-3"><input id="pName" class="form-control" placeholder="اسم المنتج"></div>
        <div class="col-md-2"><input id="pPrice" class="form-control" placeholder="السعر"></div>
        <div class="col-md-3"><input id="pImage" class="form-control" placeholder="رابط الصورة (URL)"></div>
        <div class="col-md-2">
          <select id="pCategory" class="form-control">
            <option value="mobiles">موبايلات</option>
            <option value="bluetooth">سماعات بلوتوث</option>
            <option value="cables">كابلات</option>
            <option value="chargers">شواحن</option>
          </select>
        </div>
        <div class="col-md-2"><button class="btn btn-success w-100" onclick="addProduct()">أضف المنتج</button></div>
      </div>

      <h5>قائمة المنتجات</h5>
      <div id="list"></div>

      <hr>
      <div class="mb-3">
        <button class="btn btn-primary" onclick="copyJSON()">نسخ JSON للحافظة</button>
        <button class="btn btn-secondary" onclick="downloadJSON()">تحميل products.json</button>
      </div>

      <p class="text-muted">بعد تعديل أو نسخ JSON: اذهب إلى GitHub → افتح ملف <code>products.json</code> → اضغط Edit → الصق JSON → Commit changes.</p>
    </div>
  </div>
</div>

<script>
const ADMIN_PASSWORD = 't3chn0tel'; // غيّرها فوراً بعد النشر
let products = [];

function login(){
  const v = document.getElementById('pwd').value;
  if(v === ADMIN_PASSWORD){
    document.getElementById('loginBox').style.display = 'none';
    document.getElementById('adminUI').style.display = 'block';
    loadExisting();
  }else{ alert('كلمة المرور خاطئة'); }
}

async function loadExisting(){
  try{
    const res = await fetch('./products.json?_=' + Date.now());
    products = await res.json();
  }catch(e){ products = []; }
  renderList();
}

function renderList(){
  const list = document.getElementById('list');
  list.innerHTML = '';
  products.forEach((p, i)=>{
    const div = document.createElement('div');
    div.className = 'card p-2 mb-2';
    div.innerHTML = `
      <div class="row align-items-center">
        <div class="col-2"><img src="${p.image}" style="width:100%"/></div>
        <div class="col-6">
          <b>${escapeHtml(p.name)}</b><br><small class="text-muted">${escapeHtml(p.price)} • ${escapeHtml(p.category)}</small>
        </div>
        <div class="col-4 text-end">
          <button class="btn btn-sm btn-warning" onclick="editProduct(${i})">تعديل</button>
          <button class="btn btn-sm btn-danger" onclick="deleteProduct(${i})">حذف</button>
        </div>
      </div>`;
    list.appendChild(div);
  });
}

function addProduct(){
  const name = document.getElementById('pName').value.trim();
  const price = document.getElementById('pPrice').value.trim();
  const image = document.getElementById('pImage').value.trim();
  const category = document.getElementById('pCategory').value;
  if(!name || !image){ alert('يرجى إدخال اسم ورابط صورة'); return; }
  products.push({name, price, image, category});
  clearForm(); renderList();
}

function clearForm(){ document.getElementById('pName').value=''; document.getElementById('pPrice').value=''; document.getElementById('pImage').value=''; }

function editProduct(i){
  const p = products[i];
  const newName = prompt('اسم المنتج', p.name);
  if(newName===null) return;
  const newPrice = prompt('السعر', p.price);
  if(newPrice===null) return;
  const newImage = prompt('رابط الصورة', p.image);
  if(newImage===null) return;
  const newCat = prompt('القسم (mobiles / bluetooth / cables / chargers)', p.category);
  if(newCat===null) return;
  products[i] = {name:newName, price:newPrice, image:newImage, category:newCat};
  renderList();
}

function deleteProduct(i){ if(!confirm('حذف المنتج؟')) return; products.splice(i,1); renderList(); }

function copyJSON(){ const txt = JSON.stringify(products, null, 2); navigator.clipboard.writeText(txt).then(()=>alert('تم نسخ JSON')); }

function downloadJSON(){ const dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(products, null, 2)); const a = document.createElement('a'); a.setAttribute('href', dataStr); a.setAttribute('download', 'products.json'); document.body.appendChild(a); a.click(); a.remove(); }

function escapeHtml(str){ if(!str) return ''; return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
</script>
</body>
</html>
